---
description: "Target file structure"
alwaysApply: true
---

# File structure

## 1) Папка → назначение

| Папка | Назначение |
|---|---|
| `src/` | Весь runtime-код приложения (TypeScript). |
| `src/bot/` | Telegram-бот: роутинг команд, сцены/шаги диалога, inline-кнопки, middleware. |
| `src/bot/handlers/` | Хэндлеры команд и callback-кнопок (тонкие контроллеры). |
| `src/bot/scenes/` | Многошаговые сценарии: тема → категории → генерация → вывод. |
| `src/services/` | Интеграции и бизнес-логика (OpenAI, генерация отчета, repair-логика). |
| `src/data/` | Чтение/валидация Excel, нормализация строк, извлечение категорий, фильтрация. |
| `src/storage/` | Хранилище состояния/кэша: интерфейс + реализации (memory / PostgreSQL). |
| `src/config/` | Конфигурация (env, константы, настройки лимитов/чанкинга). |
| `src/utils/` | Утилиты (логирование, форматирование, разбиение на чанки, типы). |
| `prompts/` | Шаблоны промптов (основной, repair, системные инструкции). |
| `prisma/` | Prisma schema и миграции (если включаем PostgreSQL). |
| `data/` | Локальные данные для разработки (пример Excel), в проде может монтироваться/передаваться через env path. |
| `tests/` | Тесты (юнит/интеграционные) для парсинга Excel и сборки промпта. |
| `scripts/` | Вспомогательные скрипты (проверка структуры Excel, печать категорий, smoke-тесты). |
| `docs/` | Документация проекта (PRD, tech stack, решения по архитектуре). |

## 2) Главные файлы

| Файл | Зачем нужен (1 строка) |
|---|---|
| `src/index.ts` | Точка входа: старт бота, выбор webhook/polling, инициализация зависимостей. |
| `src/bot/app.ts` | Сборка экземпляра бота (grammY), регистрация middlewares и роутов. |
| `src/bot/scenes/featureSummary.scene.ts` | Основной диалог: запрос темы → выбор категорий → запуск генерации. |
| `src/services/openai.client.ts` | Клиент OpenAI SDK и обертка над вызовами модели (таймауты/ретраи). |
| `src/services/report.generator.ts` | Логика: подготовка данных → (chunking) → запросы в LLM → сбор финального текста. |
| `src/data/excel.reader.ts` | Чтение Excel, валидация колонок, нормализация типов, загрузка в память. |
| `src/data/category.list.ts` | Получение списка доступных категорий и фильтрация строк по выбору пользователя. |
| `src/storage/state.store.ts` | Интерфейс хранилища состояния диалога и кэшей (переключаемый backend). |
| `src/config/env.ts` | Чтение env-переменных и валидация конфигурации на старте. |
| `prompts/feature_summary_prompt.md` | Основной промпт-шаблон с плейсхолдерами `{topic}`, `{selected_categories}`, `{data}`. |
| `prompts/repair_prompt.md` | Промпт для единоразового “repair” форматирования ответа при несоответствии структуре. |
| `prisma/schema.prisma` | Схема БД (если нужен Postgres): пользователи, сессии, кэш категорий, логи. |
| `.env.example` | Пример переменных окружения для локального запуска и Railway. |
| `package.json` | Скрипты, зависимости, команды `build/start`, конфиг деплоя через Railway. |
| `tsconfig.json` | Настройки TypeScript. |
| `eslint.config.js` | Конфигурация ESLint (правила качества). |
| `.prettierrc` | Конфигурация Prettier (форматирование). |
| `README.md` | Быстрый старт: локальный запуск, деплой, переменные окружения, команды. |

## 3) Генерируй новые файлы здесь

Cursor может безопасно добавлять новый код в следующие директории:

- `src/bot/handlers/`
- `src/bot/scenes/`
- `src/services/`
- `src/data/`
- `src/storage/`
- `src/utils/`
- `tests/`
- `scripts/`
- `prompts/` (только новые шаблоны/варианты промптов)
