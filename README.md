# Feature Summary Bot

Telegram-бот для агрегированного саммари результатов тестов фичей с использованием GPT-5.2 и данных из Excel.

## Описание

Бот позволяет быстро получать:
- **Агрегированные выводы** (3–5 буллитов) о том, какие типы фичей по заданной теме обычно оцениваются выше/ниже
- **Детальное саммари** по всем проектам, где встречаются фичи, релевантные заданной теме

## Требования

- Node.js v24 (Active LTS) или выше
- npm или yarn
- Telegram Bot Token (получить у [@BotFather](https://t.me/BotFather))
- OpenAI API Key

## Локальный запуск

1. Клонируйте репозиторий:
```bash
git clone <repository-url>
cd Фичебот
```

2. Установите зависимости:
```bash
npm install
```

3. Создайте файл `.env` на основе `.env.example`:
```bash
cp .env.example .env
```

4. Заполните переменные окружения в `.env`:
- `TELEGRAM_BOT_TOKEN` — токен вашего Telegram бота
- `OPENAI_API_KEY` — ключ OpenAI API
- `OPENAI_MODEL` — модель OpenAI (по умолчанию `gpt-5.2`)
- `EXCEL_PATH` — путь к Excel файлу с данными
- `BOT_MODE` — режим работы (`polling` для локальной разработки)

5. Соберите проект:
```bash
npm run build
```

6. Запустите бота:
```bash
npm start
```

Или для разработки с автоперезагрузкой:
```bash
npm run dev
```

## Структура проекта

```
├── src/
│   ├── bot/              # Telegram бот (grammY)
│   │   ├── handlers/     # Обработчики команд и callback-кнопок
│   │   └── scenes/       # Многошаговые сценарии диалога
│   ├── services/         # Интеграции (OpenAI, генерация отчетов)
│   ├── data/             # Чтение и обработка Excel
│   ├── storage/          # Хранилище состояния
│   ├── config/           # Конфигурация
│   └── utils/            # Утилиты
├── prompts/              # Шаблоны промптов
├── data/                 # Excel файлы с данными
├── scripts/              # Вспомогательные скрипты
└── tests/                # Тесты
```

## Переменные окружения

| Переменная | Описание | Обязательная |
|------------|----------|--------------|
| `TELEGRAM_BOT_TOKEN` | Токен Telegram бота | Да |
| `OPENAI_API_KEY` | Ключ OpenAI API | Да |
| `OPENAI_MODEL` | Модель OpenAI (по умолчанию `gpt-5.2`) | Нет |
| `EXCEL_PATH` | Путь к Excel файлу | Да |
| `BOT_MODE` | Режим работы: `polling` или `webhook` | Да |
| `WEBHOOK_URL` | URL для webhook (требуется если `BOT_MODE=webhook`) | Условно |
| `PORT` | Порт для webhook (по умолчанию 3000) | Условно |
| `ADMIN_USER_IDS` | ID администраторов (через запятую) | Нет |

## Деплой на Railway

1. Создайте проект на [Railway](https://railway.app)
2. Подключите GitHub репозиторий
3. Настройте переменные окружения в Railway dashboard
4. Установите `BOT_MODE=webhook`
5. Укажите `WEBHOOK_URL` (Railway предоставит публичный URL)
6. Railway автоматически соберет и задеплоит приложение

## Обновление Excel файла

В MVP версии:
- Файл должен находиться по пути, указанному в `EXCEL_PATH`
- Для обновления замените файл на сервере и перезапустите бот

В будущих версиях планируется команда `/upload` для администраторов.

## Использование

1. Отправьте `/start` боту
2. Введите тему для агрегации (например: "Качество звука", "Wellbeing", "Умный дом")
3. Выберите категории из списка (inline-кнопки)
4. Нажмите "Сгенерировать"
5. Получите агрегированные выводы и детальное саммари

## Команды

- `/start` — начать работу с ботом
- `/help` — показать справку
- `/cancel` — отменить текущий диалог

## Разработка

### Скрипты

- `npm run build` — собрать проект
- `npm run dev` — запустить в режиме разработки
- `npm run lint` — проверить код линтером
- `npm run format` — отформатировать код
- `npm test` — запустить тесты
- `npm run print-categories` — вывести список категорий из Excel

### Тестирование

```bash
npm test
```

## Лицензия

MIT
